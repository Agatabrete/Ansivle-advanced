# {{ ansible_managed }}
# Virtual Host for {{ item.name }}
# Generated on {{ ansible_date_time.iso8601 }}

<VirtualHost *:{{ http_port }}>
    ServerName {{ item.name }}
    DocumentRoot {{ item.document_root }}

    # Logging configuration
    {% if debug_mode %}
    LogLevel debug
    {% else %}
    LogLevel warn
    {% endif %}
    
    ErrorLog ${APACHE_LOG_DIR}/{{ item.name }}_error.log
    CustomLog ${APACHE_LOG_DIR}/{{ item.name }}_access.log combined

    <Directory {{ item.document_root }}>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
        
        {% if app_env == 'production' %}
        # Production security headers
        Header always set X-Frame-Options DENY
        Header always set X-Content-Type-Options nosniff
        Header always set X-XSS-Protection "1; mode=block"
        {% endif %}
    </Directory>
</VirtualHost>